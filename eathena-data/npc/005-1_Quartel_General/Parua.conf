// Parua's fight - Original from Kage
// Adapted to the brazilian server and translated to portuguese by alastrim
// Traduzido e Adaptado do original desenvolvido por kage

//-------------------------------------------------------------------------------------------------------------------------
// Coisas a fazer ou não fazer: 
// 1) Não colocar o NPC em um mapa grande demais. Isso é para evitar que os jogadores simplesmente saiam correndo dos monstros enquanto os lvls vão aumentando.(Sim, eles aumentam sozinho com o tempo também).
// 2) Colocar um script-barreira no mapa que dá acesso à arena, de modo que durante uma "luta", somente os que estão lutando podem permanecer no mapa. Quando todos morrerem o mapa é liberado novamente.
// 3) Fazer as devidas modificações no script para que seja usado no BR. 
// 4) Testar e verificar se o desafio está devidamente equilibrado.
//-------------------------------------------------------------------------------------------------------------------------

002-01.gat,46,37,0	script	Parua	307,{
	if ($@ARENA_STATUS != 0) goto L_comeca2;

	mes "[Parua]";
	mes "\"Olá.\"";
	next;
	mes "[Parua]";
	mes "\"Você gostaria de enfrentar os desafios de minha arena?\"";

	menu "Não.", L_fim,
	     "Gostaria de conhecer os recordes desta arena.", L_record,
	     "Sim.", -;

	mes "[Parua]";
	mes "\"Muito bem, mas eu cobro 20k GP para ativar a arena...\"";
	menu "Não, isso é um roubo!", L_fim,
	     "É um preço justo. O que eu preciso fazer?.", -;

	if (zeny < 20000) goto L_semgrana;
	if ($@ARENA_STATUS != 0) goto L_jacomecou;

	mes "[Parua]";
	mes "Basta responder algumas perguntas e me dar o dinheiro. Você pretende lutar sozinho ou em grupo?";	

	menu "Sozinho, eu dou conta do recado!", L_sozinho,
	     "Vou contar com a ajuda dos meus companheiros!", -;

	if (getareausers("002-01.gat", 20, 20, 70, 60) <= 1) goto L_poucosjogadores;

	mes "\"OK, agora eu só preciso que você dê o nome do grupo que vai participar desta rodada. Assim eu posso anotar seu desempenho no meu registro e comparar com os outros grupos. Escolha bem o nome, pois se você for o melhor ele aparecerá no rol da fama desta arena:\"";

	input $@GRUPO$;

	npctalk "Muito bem, vamos ver como o grupo " + $@GRUPO$ + " se sai em minha arena!";

L_comecagrupo:
	set zeny, zeny - 20000;
	npctalk "Que a luta começe!";
	set $@ARENA_STATUS, 1;
	set $@ARENA_LEVEL, 1;
	set $@ARENA_CONTA_JOGADORES, getareausers("002-01.gat", 20, 20, 70, 60);
	set $@ARENA_RESTA, 0;
	startnpctimer;
	goto L_fim;

L_comecasozinho:
	set zeny, zeny - 20000;
	npctalk "Vamos ver como você se sai sozinho!";
	set $@ARENA_STATUS, 2;
	set $@ARENA_LEVEL, 1;
	set $@ARENA_CONTA_JOGADORES, getareausers("002-01.gat", 20, 20, 70, 60);
	set $@ARENA_RESTA, 0;
	startnpctimer;
	goto L_fim;

L_comeca2:
	mes "[Parua]";
	mes "\"Aproveite a luta!\"";
	mes $@ARENA_STATUS;
	goto L_fim;

L_sozinho:
	mes "[Parua]";
	mes "\"Muito bem!\"";
	set $@INDIVIDUO$, strcharinfo(0);
	if (getareausers("002-01.gat", 20, 20, 70, 60) > 1) goto L_naosozinho;
	goto L_comecasozinho;

L_naosozinho:
	mes "[Parua]";
	mes "\"Eu estou vendo que tem mais gente aqui... Você acha que eu sou cego?.\"";
	goto L_fim;

L_semgrana:
	mes "[Parua]";
	mes "\"Parece que você não tem o dinheiro.\"";
	goto L_fim;

L_jacomecou:
	mes "[Parua]";
	mes "\"Não precisa, alguem já me deu o dinheiro.\"";
	goto L_fim;

L_poucosjogadores:
	mes "[Parua]";
	mes "\"Ei, " + strcharinfo(0) + ", não tente me enganar... Estou vendo perfeitamente que você é o único jogador nesta arena\"";
	goto L_fim;

L_record:
	npctalk "O record da arena pertence ao grupo " + $GRUPO_RECORD$ + ", que conseguiu a façanha de ser o primeiro a chegar ao nível " + $ARENA_RECORD;
	npctalk "O record individual da arena pertence ao destemido " + $RECORD_INDIVIDUAL$ + ", que foi o primeiro a chegar ao nível " + $ARENA_RECORD_INDIVIDUAL;
	L_fim:
	close;
	end;

// Fight logic
OnTimer5000:
	setnpctimer 0;
	if ($@ARENA_STATUS != 0) goto L_logicadaarena;
L_Return_1:
	set $@ARENA_CONTA_JOGADORES, 0;
	areatimer "002-01.gat", 20, 20, 70, 60, 10, "Parua::onTick";
	end;

L_logicadaarena:
	set $@ARENA_ROUND_PEN, $@ARENA_CONTA_JOGADORES;
	if ($@ARENA_ROUND_PEN > 60) set $@ARENA_ROUND_PEN, 60;
	if ($@ARENA_CONTA_JOGADORES <= 0) goto L_limpa;
	set $@ARENA_ROUND_TEMPO, $@ARENA_ROUND_TEMPO + 5; // Advance 5 seconds
	if (mobcount("002-01.gat", "Parua::onPetDeath") <= 0) goto L_proximoround;
	if ($@ARENA_ROUND_TEMPO + $@ARENA_ROUND_PEN >= 120) goto L_proximoround;
	goto L_Return_1;

L_proximoround:
	set $@ARENA_ROUND_TEMPO, 0;

	set $@ARENA_LEVEL, $@ARENA_LEVEL + $@ARENA_CONTA_JOGADORES + ($@ARENA_LEVEL / 40);
	if ($@ARENA_LEVEL >= 3000) goto L_ganhou;
	set $@ARENA_POINTS, $@ARENA_LEVEL;

	if ($@ARENA_RESTA + 30  < $@ARENA_LEVEL) goto L_anuncia;

L_Return_2:
	npctalk "Novo round começando! O nível deste round é " + $@ARENA_LEVEL;

	set $@MOB_1_SUMMON, 0;
	set $@MOB_2_SUMMON, 0;
	set $@MOB_3_SUMMON, 0;
	set $@MOB_4_SUMMON, 0;
	set $@MOB_5_SUMMON, 0;
	set $@MOB_6_SUMMON, 0;

L_Summon:
	if ($@ARENA_POINTS >= 243 && $@MOB_1_SUMMON < 3) goto L_MOB1;
	if ($@ARENA_POINTS >= 81 && $@MOB_2_SUMMON < 10) goto L_MOB2;
	if ($@ARENA_POINTS >= 27 && $@MOB_3_SUMMON < 10) goto L_MOB3;
	if ($@ARENA_POINTS >= 9 && $@MOB_4_SUMMON < 10) goto L_MOB4;
	if ($@ARENA_POINTS >= 3 && $@MOB_5_SUMMON < 20) goto L_MOB5;
	if ($@ARENA_POINTS >= 1 && $@MOB_6_SUMMON < 25) goto L_MOB6;
	goto L_Return_1;


L_anuncia:
	mapannounce "005-1.gat", "O grupo " + $@GRUPO$ + " está lutando neste instante na arena. Está começando o nível " + $@ARENA_LEVEL + " e há neste momento " + $@ARENA_CONTA_JOGADORES + " jogador(es) vivo(s)." , 0;
	set $@ARENA_RESTA, $@ARENA_RESTA + 30;
	goto L_Return_2;


L_MOB1:
	set $@MOB_1_SUMMON, $@MOB_1_SUMMON + 1;
	set $@ARENA_POINTS, $@ARENA_POINTS - 243;
	areamonster "002-01.gat", 20, 20, 70, 60, "", 1022, 1, "Parua::onPetDeath";
	goto L_Summon;

L_MOB2:
	set $@MOB_2_SUMMON, $@MOB_2_SUMMON + 1;
	set $@ARENA_POINTS, $@ARENA_POINTS - 81;
	areamonster "002-01.gat", 20, 20, 70, 60, "", 1313, 1, "Parua::onPetDeath";
	goto L_Summon;

L_MOB3:
	set $@MOB_3_SUMMON, $@MOB_3_SUMMON + 1;
	set $@ARENA_POINTS, $@ARENA_POINTS - 27;
	areamonster "002-01.gat", 20, 20, 70, 60, "", 1305, 1, "Parua::onPetDeath";
	goto L_Summon;

L_MOB4:
	set $@MOB_4_SUMMON, $@MOB_4_SUMMON + 1;
	set $@ARENA_POINTS, $@ARENA_POINTS - 9;
	areamonster "002-01.gat", 20, 20, 70, 60, "", 1304, 1, "Parua::onPetDeath";
	goto L_Summon;

L_MOB5:
	set $@MOB_5_SUMMON, $@MOB_5_SUMMON + 1;
	set $@ARENA_POINTS, $@ARENA_POINTS - 3;
	areamonster "002-01.gat", 20, 20, 70, 60, "", 1010, 1, "Parua::onPetDeath";
	goto L_Summon;

L_MOB6:
	set $@MOB_6_SUMMON, $@MOB_6_SUMMON + 1;
	set $@ARENA_POINTS, $@ARENA_POINTS - 1;
	areamonster "002-01.gat", 20, 20, 70, 60, "", 1008, 1, "Parua::onPetDeath";
	goto L_Summon;

// Called on each player once every 5 seconds
onTick:
	if (isdead(0)) end;
	set $@ARENA_CONTA_JOGADORES, $@ARENA_CONTA_JOGADORES + 1;
	end;

onPetDeath:
	end;

onInit:
	initnpctimer;
	stopnpctimer;
L_limpa:
	npctalk "Fim de Jogo.";
	mapannounce "002-01.gat", "Tudo preparado para novos grupos.", 0;
	if ($@ARENA_LEVEL > $ARENA_RECORD) && ($@ARENA_STATUS == 1) goto L_novorecordgrupo;
	if ($@ARENA_LEVEL > $ARENA_RECORD_INDIVIDUAL) && ($@ARENA_STATUS == 2) goto L_novorecordindividual;
	set $@ARENA_STATUS, 0;
	set $@ARENA_CONTA_JOGADORES, 0;
	set $@ARENA_LEVEL, 1;
	set $@ARENA_ROUND_TEMPO, 0;
	killmonster "002-01.gat", "Parua::onPetDeath";
	stopnpctimer;
	setnpctimer 0;
	end;


L_novorecordgrupo:
	set $GRUPO_RECORD$, $@GRUPO$;
	set $ARENA_RECORD_GRUPO, $@ARENA_LEVEL;
	set $@ARENA_STATUS, 0;
	set $@ARENA_CONTA_JOGADORES, 0;
	set $@ARENA_LEVEL, 1;
	set $@ARENA_ROUND_TEMPO, 0;
	killmonster "002-01.gat", "Parua::onPetDeath";
	stopnpctimer;
	setnpctimer 0;
	end;

L_novorecordindividual:
	set $RECORD_INDIVIDUAL$, $@INDIVIDUO$;
	set $ARENA_RECORD_INDIVIDUAL, $@ARENA_LEVEL;
	set $@ARENA_STATUS, 0;
	set $@ARENA_CONTA_JOGADORES, 0;
	set $@ARENA_LEVEL, 1;
	set $@ARENA_ROUND_TEMPO, 0;
	killmonster "002-01.gat", "Parua::onPetDeath";
	stopnpctimer;
	setnpctimer 0;
	end;


// L_ganhou:
	// Coisas que podem ser feitas:
	// Parabeniza os jogadores
	// Faz um anuncio global
	// Spawn de um boss com grande recompensa em XP
	// Inclusão em uma lista dos grupos ganhadores, talvez com o nome dos participantes.
	
}