/**
 * A Cartola mágica é um jogo interativo onde todos podem participar.
 * Seja como jogador ou expectador.
 * Durante uma partida, vence aquele que tirar a carlola do coelho.
 *
 * Aqui encontram-se os scripts do mágico.
 *
 * @date 21 de setembro de 2010
 * @author Diogo_RBG - http://diogorbg.blogspot.com/
 */

007.gat,58,75,0	script	Mágico	323,{
	if( $@CARTOLA_ganhador$=="" ) goto _menu;
	npctalk "'"+$@CARTOLA_ganhador$+"' ganhou a partida!!!";
	set $@CARTOLA_ganhador$, "";

_menu:
	mes "[Mágico]";
	mes "\"Abra cadabra... sim salabim... coelho apareça apara mim!\"";
	mes "...";
	mes "O mágico bate na cartola.";
	mes "\"Vamos... saia daí!";
	mes "aff!\"";
	mes "";
	mes "Voce já ganhou: "+@CARTOLA_numVit + " partidas.";

_menuNovaPartida:
	menu
		"Criar nova partida.", _novaPartida,
		"Comprar Bilhete Mágico.", _comprarBilhete,
		"Informações sobre o jogo.", _info,
		"Sair", -;
	close;

_info:
	mes "[Mágico]";
	mes "\"A Cartola Mágica é um jogo onde todos podem participar. Seja como jogador ou expectador.";
	mes "Durante o jogo, vence aquele que tirar a cartola sorteada, então, fique de olho no coelho. =)\"";
	next;
_menuInfo:
	menu
		"Legal, mas como que se joga?", _comoJogar,
		"Eu posso criar uma partida?", _comoCriarPartida,
		"Onde cosigo um Bilhete Mágico?", _ondeBilhete,
		"Voltar", _menu;
	close;

_comoJogar:
	mes "[Mágico]";
	mes "\"Primeiro você deve criar uma partida ou esperar que o líder de uma te convide.";
	mes "Se você receber o convite de um líder peça para 'Participar do Jogo' aqui comigo.\"";
	next;
	mes "[Mágico]";
	mes "\"Pode ser que o líder crie uma partida particular. Neste caso você só poderá participar do jogo se puder dizer a 'palavra mágica', que só o líder poderá te informar.\"";
	next;
	mes "[Mágico]";
	mes "\"Ao participar do jogo irá aparecer mais uma cartola no jogo. Isso indica que um novo jogador está participando do jogo. (Não significa que você deverá tirar esta cartola... escolha a que quiser).";
	mes "Assim que 7 jogadores aceitarem participar do jogo, ou por decisão do líder, o jogo será iniciado.";
	mes "Até lá você deverá aguardar pacientemente. =).\"";
	next;
	mes "[Mágico]";
	mes "\"E finalmente, quando o jogo for iniciado, você escolherá uma cartola.";
	mes "Se dela surgir um coelho é porque você tem muita sorte... e que também acaba de ganhar o jogo. \\o/\"";
	next;
	goto _menuInfo;

_comoCriarPartida:
	mes "[Mágico]";
	mes "\"Sim... você pode criar uma nova partida e se tornar líder dela.";
	mes "E o bom de se criar uma partida é que você poderá ter o domínio sobre ela.\"";
	next;
	mes "[Mágico]";
	mes "\"Se este for o seu desejo basta 'Criar Nova Partida'";
	close;

_ondeBilhete:
	mes "[Mágico]";
	mes "O Bilhete Mágico pode ser comprado comigo. Eu ainda tenho alguns para vender.\"";
	next;
	menu
		":) Ok... compo um depois", _menuInfo,
		":( Achei que ia conseguir um de graça!", _deGraca;
	goto _menuInfo;

_deGraca:
	if(@bilheteVerme!=0) goto _deGraca2;

	mes "[Mágico]";
	mes "\"Eu perdi um bilhete não faz muito tempo... me descuidei por um segundo e um vento forte o levou para bem longe daqui.";
	mes "Se você puder recuperá-lo poderá ficar com ele.\"";
	next;
	menu
		"É só me dizer pra que lado ele foi.", -;
	mes "[Mágico]";
	mes "\"Isso é fácil de responder: Ele foi pra dentro!\"";
	next;
	menu
		"Pra dentro onde?", -,
		"Pra dentro de uma casa?", -;
	mes "[Mágico]";
	mes "\"Pra dentro do estômago de um Verme. Ele o devorou sem pensar duas vezes.";
	mes "Eu desisti de ir atrás deste bilhete justamnte por isso!";
	mes "Mas me entregando este bilhete limpinho não tem problema nenhum. =)\"";
	if(@bilheteVerme==0) set @bilheteVerme, 1;
	next;
	goto _menuInfo;

_deGraca2:
	mes "[Mágico]";
	mes "\"Como eu disse. Você pode tentar recuperar o bilhete que foi carregado pelo vento e devorado por um Verme.";
	mes "Se você puder recuperá-lo poderá ficar com ele.\"";
	next;
	goto _menuInfo;

_sortear:
	npctalk "'"+strcharinfo(0)+"' iniciou uma nova partida.";
	set $@CARTOLA_partida, $@CARTOLA_partida+1;
	set @CARTOLA_partida, $@CARTOLA_partida;
	killmonster "007.gat", "Mágico::_onKill";
	callsub _zerarTodos, @menu;
	close;

OnInit:
	callsub _zerarTodos, 7;
	set $@CARTOLA_ganhador$, "";
	end;

_zerarTodos:
	set $@CARTOLA, rand(getarg(0))+1;
	callsub _zeraCartola, 1, getarg(0);
	callsub _zeraCartola, 2, getarg(0);
	callsub _zeraCartola, 3, getarg(0);
	callsub _zeraCartola, 4, getarg(0);
	callsub _zeraCartola, 5, getarg(0);
	callsub _zeraCartola, 6, getarg(0);
	callsub _zeraCartola, 7, getarg(0);
	return;

_zeraCartola:
	disablenpc "Nº "+getarg(0)+"#puft";
	if(getarg(0)<=getarg(1)) enablenpc "Nº "+getarg(0);
	if(getarg(0)>getarg(1)) disablenpc "Nº "+getarg(0);
	return;

_onKill:
	end;
}
